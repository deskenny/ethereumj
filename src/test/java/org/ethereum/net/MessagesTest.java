package org.ethereum.net;

import static org.junit.Assert.*;

import java.net.UnknownHostException;
import java.util.List;

import org.ethereum.net.message.BlocksMessage;
import org.ethereum.net.message.DisconnectMessage;
import org.ethereum.net.message.GetChainMessage;
import org.ethereum.net.message.HelloMessage;
import org.ethereum.net.message.NotInChainMessage;
import org.ethereum.net.message.PeersMessage;
import org.ethereum.net.message.TransactionsMessage;
import org.ethereum.net.rlp.RLPList;
import org.ethereum.net.vo.Block;
import org.ethereum.net.vo.PeerData;
import org.ethereum.net.vo.Transaction;
import org.ethereum.util.Utils;
import org.junit.Test;
import org.spongycastle.util.encoders.Hex;

public class MessagesTest {

    /* HELLO_MESSAGE */

    @Test /* HelloMessage 1 */
    public void test_1(){

        String helloMessageRaw = "F8 77 80 0C 80 AD 45 74 " +
                "68 65 72 65 75 6D 28 2B 2B 29 2F 5A 65 72 6F 47 " +
                "6F 78 2F 76 30 2E 35 2E 31 2F 6E 63 75 72 73 65 " +
                "73 2F 4C 69 6E 75 78 2F 67 2B 2B 07 82 76 5F B8 " +
                "40 D8 83 3B 83 56 0E 0B 12 17 0E 91 69 DC 43 78 " +
                "42 23 A5 98 42 DE 23 59 E6 D0 3D B3 4C 30 A9 66 " +
                "C2 DE 3B 4B 25 52 FB 0D 75 95 A1 85 D5 58 F2 E6 " +
                "69 B5 95 67 4F 52 17 C9 96 EE 14 88 84 82 8B E0 FD";
        byte[] payload = Hex.decode(helloMessageRaw);
        RLPList rlpList = new RLPList();
        RLP.parseObjects(payload, rlpList);

        HelloMessage helloMessage = new HelloMessage(rlpList);
        helloMessage.parseRLP();
        System.out.println(helloMessage);


        assertEquals(12, helloMessage.getProtocolVersion());
        assertEquals(0, helloMessage.getNetworkId());
        assertEquals("Ethereum(++)/ZeroGox/v0.5.1/ncurses/Linux/g++", helloMessage.getClientId());
        assertEquals(7, helloMessage.getCapabilities());
        assertEquals(30303, helloMessage.getPeerPort());
        assertEquals(
            "D8833B83560E0B12170E9169DC43784223A59842DE2359E6D03DB34C30A966C2DE3B4B2552FB0D7595A185D558F2E669B595674F5217C996EE148884828BE0FD",
            Utils.toHexString(helloMessage.getPeerId()).toUpperCase() );
    }

    @Test /* HelloMessage 2 */
    public void test_2(){

        String helloMessageRaw = "F87F800B80B5457468657265756D282B2B292F76302E342E332F4554485F4255494C445F545950452F4554485F4255494C445F504C4154464F524D0782765FB840E02B18FBA6B887FB9258469C3AF8E445CC9AE2B5386CAC5F60C4170F822086224E3876555C745A7EC8AC181C7F9701776D94A779604EA12651DE5F4A748D29E1";
        byte[] payload = Hex.decode(helloMessageRaw);
        RLPList rlpList = new RLPList();
        RLP.parseObjects(payload, rlpList);

        HelloMessage helloMessage = new HelloMessage(rlpList);
        helloMessage.parseRLP();
        System.out.println(helloMessage);

        assertEquals(11, helloMessage.getProtocolVersion());
        assertEquals(0, helloMessage.getNetworkId());
        assertEquals("Ethereum(++)/v0.4.3/ETH_BUILD_TYPE/ETH_BUILD_PLATFORM", helloMessage.getClientId());
        assertEquals(7, helloMessage.getCapabilities());
        assertEquals(30303, helloMessage.getPeerPort());
        assertEquals(
                "E02B18FBA6B887FB9258469C3AF8E445CC9AE2B5386CAC5F60C4170F822086224E3876555C745A7EC8AC181C7F9701776D94A779604EA12651DE5F4A748D29E1",
                Utils.toHexString(helloMessage.getPeerId()).toUpperCase() );
    }

    /* DISCONNECT_MESSAGE */

    @Test /* DisconnectMessage 1 */
    public void test_3(){

        String disconnectMessageRaw = "C20100";
        byte[] payload = Hex.decode(disconnectMessageRaw);
        RLPList rlpList = new RLPList();
        RLP.parseObjects(payload, rlpList);

        DisconnectMessage disconnectMessage = new DisconnectMessage(rlpList);
        System.out.println(disconnectMessage);

        assertEquals(disconnectMessage.getReason(),
                DisconnectMessage.REASON_DISCONNECT_REQUESTED);
    }

    @Test /* DisconnectMessage 2 */
    public void test_4(){

        String disconnectMessageRaw = "C20101";
        byte[] payload = Hex.decode(disconnectMessageRaw);
        RLPList rlpList = new RLPList();
        RLP.parseObjects(payload, rlpList);

        DisconnectMessage disconnectMessage = new DisconnectMessage(rlpList);
        System.out.println(disconnectMessage);

        assertEquals(disconnectMessage.getReason(),
                DisconnectMessage.REASON_TCP_ERROR);
    }

    /* PEERS */

    @Test /*  PeersMessage 1*/
    public void test_5(){

        String peersMessageRaw = "F902BC11F84CC65381AC81E24F82765FB84033F506917503D16ECA1574F73D427BB6BC8725BED28542151E966C71FF5E9EE2EB0B09A8A6D7F6BC9E3F58F407F3DEDF174C4B6D6426973FB874E18F9ACB2BB6F84DC781C87681AB81BE82765FB840370A33EE6716C22E8AB13FF666C2389BDF0947F2FD8C15F3ABA5D545A0B78F7A8ABB95FD575073BE596D237038149A3B71E3A8F30B55AE70ED0189803FD62F24F84CC66A81A80E81F982765FB84052C1D33B5635C25504AD3985A79BEE3FF26CA5A17D351B8775E7ACEBAB1365624C9EE3CDFF843AFD07B235D8569196C781115E8DCAEF93E0383B20CFA64766D0F84AC455417E2D82765FB84082A8A5831D3B4FB76CF130CDC8A2B162A85D005D82A1DCC9B73239035EADE6347EDE2FFC86571ABE348EA38699CE886AA3D425FE58182C433434AB4CFD7B5B88F84CC6443081AD81A3827A51B840A5FD77C0D432FBFA3317084914C2E8A8821E4BA1DCBA44961FF7480E6DB608789CAB6291416360EA8CDC26B0D2F0877C50E89A70C1BCF5D6DD8B182E0A9E37D3F84AC436481F3782765FB840CE73660A06626C1B3FDA7B18EF7BA3CE17B6BF604F9541D3C6C654B7AE88B239407F659C78F419025D785727ED017B6ADD21952D7E12007373E321DBC31824BAF84AC455417E2D82765FB840CE73F1F1F1F16C1B3FDA7B18EF7BA3CE17B6F1F1F1F141D3C6C654B7AE88B239407FF1F1F1F119025D785727ED017B6ADD21F1F1F1F1000001E321DBC31824BAF84CC66B81AA3981F782765FB840E02B18FBA6B887FB9258469C3AF8E445CC9AE2B5386CAC5F60C4170F822086224E3876555C745A7EC8AC181C7F9701776D94A779604EA12651DE5F4A748D29E1F84EC881BF81B181D1819F82765FB840EFDFAE4BC66C2FBAAA70FEC4E764552256D3E15B143FA8F9EF278A5E042221BA0D4E8688DD4BA9582ABAC97D81B9418E50391204E9335E8E37CD16B7D95193A7";
        byte[] payload = Hex.decode(peersMessageRaw);
        RLPList rlpList = new RLPList();
        RLP.parseObjects(payload, rlpList);

        PeersMessage peersMessage= new PeersMessage(rlpList);
        System.out.println(peersMessage);

        assertEquals(9, peersMessage.getPeers().size());

        PeerData peerData = peersMessage.getPeers().get(3);

        assertEquals("/85.65.126.45", peerData.getInetAddress().toString());
        assertEquals(30303, peerData.getPort());
        assertEquals("82A8A5831D3B4FB76CF130CDC8A2B162A85D005D82A1DCC9B73239035EADE6347EDE2FFC86571ABE348EA38699CE886AA3D425FE58182C433434AB4CFD7B5B88",
                Utils.toHexString( peerData.getPeerId() ).toUpperCase());
    }

    @Test /*  PeersMessage 2 */
    public void test_6(){

        String peersMessageRaw = "F9175011F84CC681836881FC0482765FB840077E537A8B3673E8F1B625DBCC902EA7D4CED9402E4664E873679512CC2360698E53425652A04624FCF78CDBA1A3233087A919A34D11AEDACEEEB7D833FCBF26F84CC66381E75881AF82765FB8400AB2CDE83A098403DDC2EA5414740D8A0193E449C96E112419967ABC62EB17CDCED77AE0AB075E04F7DDDCD43FB9048BE53206A040620BDE26CB743FA312319FF84BC545818F165582765FB84015D678DBB6C9F241133DD2F5EAC96B1B8308C556037D83F63A3729DDE4C3F84ED8491C7C645827DC54CE32AB8A759EE04EA079F2703F352BBA24ED6249B47CA5F84EC881BF81B181D1819F82765FB84019549FBE60B8A8D8188C9F1741325C92A5CE2226F23B40053FB68D90ED4DD551C891952ABDB9A894713EE9A7B037D06822F8EBC68F53326D9559BFE8277BE4E9F84DC781CF81DB45819A82765FB84019C33DA7031CFF177EFA842FAA3D31BD83E1764EC610F236944A9F8A21C1C51A04F47F6B5FC3EFE65CAF369443635AFC58D8F5D4E2F12AF9EEEC3C6E30BF0A2BF84CC6443081AD81A382765FB8401E59C282081294808497AE7A7E976798C42B8BCCE13C9D8B0ECF8AFECDB5DFD4EFA8770FC0D1F7DE63C91640E7E8B4358C9E3ED0F3D6C98620AD7EA42418C9ECF84BC51F12819E4882765FB8401F68C075C1D87BC04765430FDFB1E5D00F1B784ED6BE721E4CAFF7BEB57B4B217B95DA19B5EC66045868B39AAC2E0876CF80F0B68D0FA20BDB9036BEAA7061EAF84CC681BF81EA393782765FB84021780C55B47DB4B11467B5F55B0B555E0887CE36FBD975E224B1C70EAC7AB8E8C2DB37F0A48B90FFDD5A379ADA99B6A0F6429C4A53C25558191A682636AEF4F2F84CC6443081AD81A382765FB8402315CB7CF49B8EAB212C5A45790B50797739738F5F733439B190119737EE8C09BC723794712AA82F2670BC581AB0757EF23137AC0FDF0F8C8965E7DD6BA79F8CF84AC455417E2D82765FB8402A38EA5D9A7EFD7FFFC0A81D8EA7ED28311C4012BBAB1407C8DAD2685129E042172734A328E8907F9054B8225FE77041D8A486A97976D2837242AB6C8C5905E4F84CC681836881FC0482765FB840324DD936384D8C0DDEFDE04BA7402998ABBD63D79C0BF8586B3DD2C7DBF6C91EB80A7B6DE8F16A50044F149C7B39AAFB9C3AD7F2CAA40355AAB09888186FCCA2F84CC65381AC81E24F82765FB84033F506917503D16ECA1574F73D427BB6BC8725BED28542151E966C71FF5E9EE2EB0B09A8A6D7F6BC9E3F58F407F3DEDF174C4B6D6426973FB874E18F9ACB2BB6F84DC781C87681AB81BE82765FB840370A33EE6716C22E8AB13FF666C2389BDF0947F2FD8C15F3ABA5D545A0B78F7A8ABB95FD575073BE596D237038149A3B71E3A8F30B55AE70ED0189803FD62F24F84CC6443081AD81A382765FB840394245C0991633ED060BAFB9646853D344188B804FE37E25A5BCAC44ED443A84A68B3AAF155EFE4861E84B4B515F9A5DECDBD7DAE98192D7A320A792C7D4DFAFF84DC75681B781E781CD82765FB840398650F67B2292939DE34C0EAEB9141F9484A0FB173FA33F81A1F7315D0EB77BDE3A76C38636FAE66FA14BF2AFDFD63E60ABD40E29B02A914E65DE5789983FD4F84CC64481B981EA4082765FB8403A15587A1C3ADABF0291B307F71B2C04D198AAE36B834995D3305DFF42F1AB86F483AE129E9203FBC6EF2187C8621EDD18F61D53EAA5B587FFDEA4D926489038F84DC781CF81DB45819A82765FB8403B1462040EA778E3F75E65CE2453418A662E6212C9F65B02EAB58D22B287E45053BDE5EBF060960CBFA0D9DC85BF51BA7AA1F2CAA2C13682D93277641D60DBEBF84CC66A81A80E81F982765FB8403ECC97AB15D22F7B9EDF19C04CE3B6095FA2504214002B35989C6F81EE4B961CC2A899C49415C914E313908340047D1D3B25D74F5B9C85A06AFA2659A539992EF84BC52E0481C10982765FB840407C22003F3BBAA6CBEB8E4B0AB7073073FEAB85182B405525F8BD283255043D713518F74748D92C43FBB99ECC7C3FBAB95D598006513AA8E59C48041C8B41C2F84BC5327E5681C282765FB840408C9324203BD8262FCE6506BA59DCDD567089B0EB9A5BB183477BABBF6163914ACDC7F495F8964D8AC12FE2401887B8CD8D97C0C9DCCFADDBB20A3C3147A789F84AC4266C4F6882765FB840423E4004DA2FA7500BC012C0674AA6571502C53AA4D91EFA6E2B5CB1E468C462CA3114A2E2EB0965B7044F9C9575965B47E47A41F13F1ADC03A2A4B342D7128DF84BC54081E7082D82765FB84042839375272C2F3DEADB28085D06055E353135C6C8D896097A1BC480C4884FD1604518CBDF731AC18F0984B7F02148E88290D13C224D82464314E2B5962E3F89F84BC581CB22640282765FB84043BFC2EBC291825D9EC00C636330235DCEDF3A623F4F08E49BCC1504D8E9B165F0A0FE976C1881455BB3051C7B604F64AC45C117C275C636F1A36ABFB11544FBF84DC73281AA81D881C882765FB84044CF19446CA465018E4DE6C60FC0DF529EBA250292EF7441E1DB59841C69F022F6092810C9A5A7F274F2F97C4BD6C76EADC064C7D6597CAEB17ED87CB257735FF84BC532819C5A5382765FB840461C9B54E91953C5BBC31C6712A917382BE67D60F75EB7F50651BEA3E594D0D19C2229D8F66ADB3F203F600038E7CC934DC92787FAC4392B9BFA7CBC786FD05BF84BC58186647D2982765FB84048353A0058E26448D94E59336CCA9D28A9374120DEF76C4BCCFEE18B0123E59192393A2EE3044D80E0EECBB09476BE62FDE1E874F93D05EA5C4A9A45C06E8FE1F84BC54E080581BB82765FB84048E8950949D4C00BCDBBE939C5BF078F2CBFF10884AF1660B1C322B9CAA3BA357BB4157FC6B0039AF9438DFE51EC278A47FCD3B726FA0A087D4C3C01A62F335EF84AC6584581C681C607B8404A0255FA4673FAA30FC5ABFD3C550BFDBC0D3C973D35F726463AF81C54A03281CFFF22C5F5965B38AC630152987757A31782478549C36F7C84CB4436BA79D6D9F84BC54081E7082D82765FB8404C7547AB4D541E10164CD3741F3476ED194B0AB9A136DFCAC3943F97358C9B0514142736CA2F170F125229057B473244A6230BF5471AD168188524B2B5CD8B7BF84CC6443081AD81A382765FB8404D5E4875D60EB4EEAFB6B2A7D3936ED3C9BC58ACAADE6A7F3C5F25598C20B364F12BEA2FB1DB3B2C2EF64785A47D6B6B5B103427CBAC0C88B18FE92A9F5393F8F84BC5520C81E35482765FB8404FD898627574D3E86B3F5A65C3EDC2E5DA84535926E4A28820B0038B19636E07DB5EB004D791F8041A006E33E108E4EC535499D128D8D9C5CAF6BBDC2204F76AF84CC66A81A80E81F982765FB84052C1D33B5635C25504AD3985A79BEE3FF26CA5A17D351B8775E7ACEBAB1365624C9EE3CDFF843AFD07B235D8569196C781115E8DCAEF93E0383B20CFA64766D0F84BC581B4202B0882765FB84053CCF25AB59409ECBB903D2EC3A9AA2EB39D7CC4C7DB7E6F68FD711A7CEBC606216DE737826DA42093E3E6521EE4770EB2D669DC4BF3546CC757C34012696EAEF84AC44C67374782765FB840600A77FB14E792C0C70DC4ADE382ED604362B978B19B94C4ED188338A1795D2DB45F7F223B66BAEBA391C59B5588B44EBAF71C7EB39755C27229C7FDE641BECEF84BC545818F165582765FB840634C1D314F4D0AE98A0A57D406091FC055E023F8A02800E93273BA34928D063877B7D5E7301ACBBEDA7BD4A7DFA3C3DBC840BB443E8863A6C514B82F2273A2DDF84BC56D2B819A4282765FB84069DD445F67C3BEF394F9549FDAE1623DBC20884A62FD5616DDBB49F84BA87E147CB8A50BA971D730C4621D0EB65133494E94FA5EA2E69C661F6B12E7ED2A8D4EF84BC518093D819B82765FB8406B5D4C35FFD1F5A198038A90834D29A1B88BE0D5EFCA08BC8A2D5881180B0B416BE00629AABE450A50828B8D1EE82D98F5528187EE67ED6E073BCEEFCDFB2BC9F84AC455417E2D82765FB8406CBB1ED536DC3858C1F063429BD3952A5D32EF8E11526CDFE72F41FEA1ACE960187C9975ABBC23783511C00F2698354747F905AAAC11DCD2B7478B3EAF327AC6F84BC54081E7082D82765FB8406EA28F64EA1CC3B6572544FD5BF743B0EAABE017F514730C897DA3C77F03C516F1E5F31D793B4BCE3CAA1DED56356D20B2EBB55A7066F41C25B7C3D56614E06BF84AC455417E2D82765FB84072532408E8BE6D5E2C9F650FB9C9F99650CC1FA062A4A4F2CFE4E6AE69CDD2E8B23ED14AFE66955C23FA048F3A976E3CE8169E505B6A89CC53D4FAC20C2A11BFF84DC77481FB81DD81FB82765FB84077B92DC86BC2599EEF46CAF2E84338165AE58971256A92CF0B802B6B510D9F690D1C0DA48A74C1A7C5FFFF46A267F5E3AB501D6F5E81E32EFCBB4EA4EC103CF3F84CC65281D94881A982765FB8407AEEA43360B9368B30E7F48286613FD1E3B0207FB71F0308D50412114463E77AB83027C0D40CADAAB8BBF612FC5B6967FA1C407329D47EC61FB0DC3DA1086832F84CC681A68193534F82765FB8407B3CDDE058D5B45D8DB2243660CFEA02E074EC213114C251D7C0C32D0403BB7AB47713D2492FF6C881CFC2AAC3F52CB269768C8968F3B6B18BAC9722D05331F6F84CC681B43881A23C82765FB840817219171552FE8DCF019EDDB90187FB0DE6A471456809698AB5251E6F498D8DF15C34CF1D86F4320689E458483657F04FA651407AFDBB2B2A91D5FBFCAD4FD6F84AC455417E2D82765FB84082A8A5831D3B4FB76CF130CDC8A2B162A85D005D82A1DCC9B73239035EADE6347EDE2FFC86571ABE348EA38699CE886AA3D425FE58182C433434AB4CFD7B5B88F84CC66A81A80E81F982765FB84087AB581BB97C212A2DA7EF0D6E105E41B55E4E42CBB6A1AF9A761A01CA8C65069AB4B5827E322CF2C5F59E7F592BE2A817C45AB641F5A9DD368963C73F9EE688F84CC65281D94881A982765FB8408C660DBC6D3DB0186AD10F05FD4F2F0643778EC514E8452A7550C630DA21171A29B1BB67C2E8E101EA1DB39743F3E78C4D2676A13D15515121515FC38B048F37F84CC66381E75881AF82765FB84094FE3D52A2894CEDC6B15424156EB8738A8441DD74BA9CED6664ED30A332A95B574D89262EA367FA900AE9706FB81A408287BDDEF3A9DD9FF44E3A41BC090FDCF84CC64D81B781903782765FB840951FAFCB6F521F0AA23BC58AF19CC40D6795124D89DC8E0CAF23369B67726A1BF6A7B4EF59CD983059B6A67C15F409903C96577CEDDACD89C7423A103C134E08F84DC781D5818181E60A82765FB840952114F110E8AC00DFEA5F050D955E764C7CBA8FB207C05A7AA5AE849168640A2B4E314391FC3A76795B3827055462639CFF4AE2D64AB80E95274428313E366AF84CC6584581C681C682765FB84096F347B096ED1630F474B97623E45E8D471B1D43C22F599607C8B2E3ED0D7B7905D8554AD399DBD739C76126404424D8DB0DC7D2B047C1A328AE27D40906C583F84CC681836881FC0482765FB8409A22C8FB1BD8BBD02F0E74ED9D3D55B0F5B09672BC43A2D47B1ED04238C1C32B6A657426525B15518236E9789B546A4A072A605E1373FE5B996BAEDC30359428F84BC5520C81E35482765FB8409B1A3A8D771B3D949CA394A88EB5DC29A953B02C81F017361FFC0AFE09ABCE3069171A87D474523687FCC9A9D32CC02CFAB4132256FEAABFE05F7AC747194E88F84BC54281D7781C82765FB8409FA7E55B2D98F1D744C76232E4FDA242FE9FD3D5743D16D3CAD2E548A07CB5AF06FE60EBAEB8C6095028179234DCDDD3CDCF1FCFE6EDAA2A53307FD103DA4AF0F84AC455417E2D82765FB840A01F834E9D1A613C3C747E561CAC19CB12D879C1A57420A49C23652B8F51288C8B111AA3888998B05E327F47A235C6A4A377F888E3005A2D4B03ECB7268608D3F84CC6443081AD81A3827A51B840A5FD77C0D432FBFA3317084914C2E8A8821E4BA1DCBA44961FF7480E6DB608789CAB6291416360EA8CDC26B0D2F0877C50E89A70C1BCF5D6DD8B182E0A9E37D3F84DC7818881A081983182765FB840AE31BD0254EE7D10B80FC90E74BA06BA761187DF3138A9799DE5828D0163524C44BAC7D2A9B5C41BE5BE8289A172361F0BA90410C94F579BF7EBD28F18AAA1CDF84AC455417E2D82765FB840BA3D216772CDC74558D2545624A2D62DCBCFD272305730C74643C7A7E819AFA6CDD82223E2B5501EB6D4EAE5DBF21E558C768ACAEC2C1CA10E74C4C87A574B53F84AC455417E2D82765FB840BDB49C01872D91BD1EA990BD2EDF16C48171A6067F9A6F7F48BFB194630B5AE9031B5DC263F59C66ADA444CB4E6F9DF62B3017CE612CAB7B53DA08D356F78D30F84CC66381E75881AF82765FB840C12BA91F95044D78EED1D3A9535EBD6471524418135EEB46AD5D5C6ECC2F5168B4AB3A062BB0742AEA65FFEA767FAB8DCC21783CB29BF32E2CD6222209FA71FDF84CC6443081AD81A3827A51B840C2E269E64AA8C9BE2D41812A48AFA2346BD41A1AB2E4646241AE3B8D0CCD41F2D682B15A025F759C0D955A6071D4E8EA7D4DE397D6E052230920113B6EB74C09F84AC44A4F177782765FB840C303B83F6A161F996736344480AE9D88FDC1D9C675BFACA888F70F24897265628209DA53741E03C0F65921F68F602DC9F334A3C45BCB92AF8544A6FB119BD887F84BC50C81FA611A82765FB840C76E7C157B7735511153D1F95081A144E088A989171F3D432CC5D8293ECE9CFAA483C032155D7B53656A6E33A3D75CD0624E09A2F949C156093DBAA83F1111F2F84BC5520C81E35482765FB840C7D5A3691A59599DE333489CBF8A47A7433E92C72706E13D94ED211296D35C97D8357D7E07B3858564D7268ED7AA097F37589C27770F90DD0B07635BE3F53364F84CC64E09819281B282765FB840C88197A82B0ACF0A872494D1DFAC9DE846DAA7DE08B240647A96BA72FBE08FD52B55C6C94514A47EC51BA49A975489EBC9383B48F5E240939068CE5836FF24F1F84BC581B4202B0882765FB840C9E039D8A8B9E435BEF2F45FC7CB7E788716E8C7AFC1BACC64E1246D2AB506D36073792AE696E41AD6BA0C8ABD2EC0D545B0757F94A9F3538280E56DB5F5D8ECF84BC54E6881A35182765FB840CA27683702A8E9BF3201656FF84A60D5B1DD814273993CF1A025B054454E40D53092F48518EE05BEAD4F18021F4F540C0B7C7D26EBA50EA4890B9E5E49A76C5FF84AC436481F3782765FB840CE73660A06626C1B3FDA7B18EF7BA3CE17B6BF604F9541D3C6C654B7AE88B239407F659C78F419025D785727ED017B6ADD21952D7E12007373E321DBC31824BAF84AC455417E2D82765FB840CE73F1F1F1F16C1B3FDA7B18EF7BA3CE17B6F1F1F1F141D3C6C654B7AE88B239407FF1F1F1F119025D785727ED017B6ADD21F1F1F1F1000001E321DBC31824BAF84BC549310781F382765FB840D553D2596461568CC7365D53F92F387FD39F10C4A9AC388EBFA1F59761F2DF215669B1C4A255DCC33E271573A01CBD1E12F0DF40C3DDC609C59F3E9A6E346EE1F84CC66B81AA3981F782765FB840E02B18FBA6B887FB9258469C3AF8E445CC9AE2B5386CAC5F60C4170F822086224E3876555C745A7EC8AC181C7F9701776D94A779604EA12651DE5F4A748D29E1F84CC64081E70A81D082765FB840E31115A76FA7FB2EFD3CFAF46AD00B05FC3498E1BAF1785DFFE6CA69913D256531D180564235FD3D3C10409CD11FC259CF7CFDA9B6BB253340412D82878F3BD3F84BC5415E31819782765FB840E5E8D8C2D762D21CA1E9BCEE8ADC53600F2D894097542666D6B5F41B23584B07F60901AB409DDF91E0CD2562DAFFF2CB0F221EB9F1156F781A5D9931A02A2E07F84CC65D818681C24982765FB840ECF3D13E7843E1B2537B742FA689912F7CFFB5D75E2CDD6732AAD1A3088F06066B435C0FA6D95C82A948AE0A1A0067D11A15668F70974299FD0F52CCD87D67DDF84EC881BF81B181D1819F82765FB840EFDFAE4BC66C2FBAAA70FEC4E764552256D3E15B143FA8F9EF278A5E042221BA0D4E8688DD4BA9582ABAC97D81B9418E50391204E9335E8E37CD16B7D95193A7F84BC5567C5281FE82765FB840F6155F1A60143B7D9D5D1A440D7D52FE6809F69E0C6F1E0024457E0D71DD88ADE3B13AAA940C89AC0610952B48BD832C42E343A13E61FFDB06010CFFC345E053F84CC66381E75881AF82765FB840FA568561B7D5288DF7A506C9BC1C9512AB396E68C46F0E62C21DC1AA584B844A8A7E944F6971303665FD37B138D9A5F637E672EDB98969664C4E7FD1C4126DEF";
        byte[] payload = Hex.decode(peersMessageRaw);
        RLPList rlpList = new RLPList();
        RLP.parseObjects(payload, rlpList);

        PeersMessage peersMessage= new PeersMessage(rlpList);
        System.out.println(peersMessage);

        assertEquals(77, peersMessage.getPeers().size());

        PeerData peerData = peersMessage.getPeers().get(7);

        assertEquals("/191.234.57.55", peerData.getInetAddress().toString());
        assertEquals(30303, peerData.getPort());
        assertEquals("21780C55B47DB4B11467B5F55B0B555E0887CE36FBD975E224B1C70EAC7AB8E8C2DB37F0A48B90FFDD5A379ADA99B6A0F6429C4A53C25558191A682636AEF4F2",
                Utils.toHexString( peerData.getPeerId() ).toUpperCase());

        peerData = peersMessage.getPeers().get(75);

        assertEquals("/86.124.82.254", peerData.getInetAddress().toString());
        assertEquals(30303, peerData.getPort());
        assertEquals("F6155F1A60143B7D9D5D1A440D7D52FE6809F69E0C6F1E0024457E0D71DD88ADE3B13AAA940C89AC0610952B48BD832C42E343A13E61FFDB06010CFFC345E053",
                Utils.toHexString( peerData.getPeerId() ).toUpperCase());
    }

    @Test /* Peers msg parsing performance*/
    public void test_7() throws UnknownHostException {

        long time1 = System.currentTimeMillis();
        for (int i = 0; i < 20000; ++i){

            String peersPacketRaw = "F9152E11F84CC681836881FC0482765FB840077E537A8B3673E8F1B625DBCC902EA7D4CED9402E4664E873679512CC2360698E53425652A04624FCF78CDBA1A3233087A919A34D11AEDACEEEB7D833FCBF26F84CC66381E75881AF82765FB8400AB2CDE83A098403DDC2EA5414740D8A0193E449C96E112419967ABC62EB17CDCED77AE0AB075E04F7DDDCD43FB9048BE53206A040620BDE26CB743FA312319FF84BC545818F165582765FB84015D678DBB6C9F241133DD2F5EAC96B1B8308C556037D83F63A3729DDE4C3F84ED8491C7C645827DC54CE32AB8A759EE04EA079F2703F352BBA24ED6249B47CA5F84DC781CF81DB45819A82765FB84019C33DA7031CFF177EFA842FAA3D31BD83E1764EC610F236944A9F8A21C1C51A04F47F6B5FC3EFE65CAF369443635AFC58D8F5D4E2F12AF9EEEC3C6E30BF0A2BF84CC6443081AD81A382765FB8401E59C282081294808497AE7A7E976798C42B8BCCE13C9D8B0ECF8AFECDB5DFD4EFA8770FC0D1F7DE63C91640E7E8B4358C9E3ED0F3D6C98620AD7EA42418C9ECF84BC51F12819E4882765FB8401F68C075C1D87BC04765430FDFB1E5D00F1B784ED6BE721E4CAFF7BEB57B4B217B95DA19B5EC66045868B39AAC2E0876CF80F0B68D0FA20BDB9036BEAA7061EAF84CC681BF81EA393782765FB84021780C55B47DB4B11467B5F55B0B555E0887CE36FBD975E224B1C70EAC7AB8E8C2DB37F0A48B90FFDD5A379ADA99B6A0F6429C4A53C25558191A682636AEF4F2F84CC6443081AD81A382765FB8402315CB7CF49B8EAB212C5A45790B50797739738F5F733439B190119737EE8C09BC723794712AA82F2670BC581AB0757EF23137AC0FDF0F8C8965E7DD6BA79F8CF84EC881BF81B181D1819F82765FB840249A3641E5A8D08E41A5CFC8DAE11F1761254F4FD47D9B13338DB8E6E3729E6F2AC9EC097A5C809684D62A41E6DFC2FFF72DC3DBD97EA26132BB97640565BB0CF84AC455417E2D82765FB8402A38EA5D9A7EFD7FFFC0A81D8EA7ED28311C4012BBAB1407C8DAD2685129E042172734A328E8907F9054B8225FE77041D8A486A97976D2837242AB6C8C5905E4F84CC66A81A80E81F982765FB8402CB30D5314ECE47E5B43DBD27A12CAD9A55CF57DD6EFB467151FEE95B9217B8BE2AB6214E07EFD9535660AE9C4FB932D2947ED6EDCD54F11081BA0FF7F30CE42F84CC681836881FC0482765FB840324DD936384D8C0DDEFDE04BA7402998ABBD63D79C0BF8586B3DD2C7DBF6C91EB80A7B6DE8F16A50044F149C7B39AAFB9C3AD7F2CAA40355AAB09888186FCCA2F84CC6443081AD81A382765FB840394245C0991633ED060BAFB9646853D344188B804FE37E25A5BCAC44ED443A84A68B3AAF155EFE4861E84B4B515F9A5DECDBD7DAE98192D7A320A792C7D4DFAFF84DC75681B781E781CD82765FB840398650F67B2292939DE34C0EAEB9141F9484A0FB173FA33F81A1F7315D0EB77BDE3A76C38636FAE66FA14BF2AFDFD63E60ABD40E29B02A914E65DE5789983FD4F84CC64481B981EA4082765FB8403A15587A1C3ADABF0291B307F71B2C04D198AAE36B834995D3305DFF42F1AB86F483AE129E9203FBC6EF2187C8621EDD18F61D53EAA5B587FFDEA4D926489038F84DC781CF81DB45819A82765FB8403B1462040EA778E3F75E65CE2453418A662E6212C9F65B02EAB58D22B287E45053BDE5EBF060960CBFA0D9DC85BF51BA7AA1F2CAA2C13682D93277641D60DBEBF84CC66A81A80E81F982765FB8403ECC97AB15D22F7B9EDF19C04CE3B6095FA2504214002B35989C6F81EE4B961CC2A899C49415C914E313908340047D1D3B25D74F5B9C85A06AFA2659A539992EF84BC52E0481C10982765FB840407C22003F3BBAA6CBEB8E4B0AB7073073FEAB85182B405525F8BD283255043D713518F74748D92C43FBB99ECC7C3FBAB95D598006513AA8E59C48041C8B41C2F84BC5327E5681C282765FB840408C9324203BD8262FCE6506BA59DCDD567089B0EB9A5BB183477BABBF6163914ACDC7F495F8964D8AC12FE2401887B8CD8D97C0C9DCCFADDBB20A3C3147A789F84AC4266C4F6882765FB840423E4004DA2FA7500BC012C0674AA6571502C53AA4D91EFA6E2B5CB1E468C462CA3114A2E2EB0965B7044F9C9575965B47E47A41F13F1ADC03A2A4B342D7128DF84BC54081E7082D82765FB84042839375272C2F3DEADB28085D06055E353135C6C8D896097A1BC480C4884FD1604518CBDF731AC18F0984B7F02148E88290D13C224D82464314E2B5962E3F89F84DC73281AA81D881C882765FB84044CF19446CA465018E4DE6C60FC0DF529EBA250292EF7441E1DB59841C69F022F6092810C9A5A7F274F2F97C4BD6C76EADC064C7D6597CAEB17ED87CB257735FF84BC532819C5A5382765FB840461C9B54E91953C5BBC31C6712A917382BE67D60F75EB7F50651BEA3E594D0D19C2229D8F66ADB3F203F600038E7CC934DC92787FAC4392B9BFA7CBC786FD05BF84BC58186647D2982765FB84048353A0058E26448D94E59336CCA9D28A9374120DEF76C4BCCFEE18B0123E59192393A2EE3044D80E0EECBB09476BE62FDE1E874F93D05EA5C4A9A45C06E8FE1F84BC54E080581BB82765FB84048E8950949D4C00BCDBBE939C5BF078F2CBFF10884AF1660B1C322B9CAA3BA357BB4157FC6B0039AF9438DFE51EC278A47FCD3B726FA0A087D4C3C01A62F335EF84AC6584581C681C607B8404A0255FA4673FAA30FC5ABFD3C550BFDBC0D3C973D35F726463AF81C54A03281CFFF22C5F5965B38AC630152987757A31782478549C36F7C84CB4436BA79D6D9F84BC54081E7082D82765FB8404C7547AB4D541E10164CD3741F3476ED194B0AB9A136DFCAC3943F97358C9B0514142736CA2F170F125229057B473244A6230BF5471AD168188524B2B5CD8B7BF84CC6443081AD81A382765FB8404D5E4875D60EB4EEAFB6B2A7D3936ED3C9BC58ACAADE6A7F3C5F25598C20B364F12BEA2FB1DB3B2C2EF64785A47D6B6B5B103427CBAC0C88B18FE92A9F5393F8F84BC5520C81E35482765FB8404FD898627574D3E86B3F5A65C3EDC2E5DA84535926E4A28820B0038B19636E07DB5EB004D791F8041A006E33E108E4EC535499D128D8D9C5CAF6BBDC2204F76AF84BC581B4202B0882765FB84053CCF25AB59409ECBB903D2EC3A9AA2EB39D7CC4C7DB7E6F68FD711A7CEBC606216DE737826DA42093E3E6521EE4770EB2D669DC4BF3546CC757C34012696EAEF84AC44C67374782765FB840600A77FB14E792C0C70DC4ADE382ED604362B978B19B94C4ED188338A1795D2DB45F7F223B66BAEBA391C59B5588B44EBAF71C7EB39755C27229C7FDE641BECEF84BC56D2B819A4282765FB84069DD445F67C3BEF394F9549FDAE1623DBC20884A62FD5616DDBB49F84BA87E147CB8A50BA971D730C4621D0EB65133494E94FA5EA2E69C661F6B12E7ED2A8D4EF84BC518093D819B82765FB8406B5D4C35FFD1F5A198038A90834D29A1B88BE0D5EFCA08BC8A2D5881180B0B416BE00629AABE450A50828B8D1EE82D98F5528187EE67ED6E073BCEEFCDFB2BC9F84AC455417E2D82765FB8406CBB1ED536DC3858C1F063429BD3952A5D32EF8E11526CDFE72F41FEA1ACE960187C9975ABBC23783511C00F2698354747F905AAAC11DCD2B7478B3EAF327AC6F84BC54081E7082D82765FB8406EA28F64EA1CC3B6572544FD5BF743B0EAABE017F514730C897DA3C77F03C516F1E5F31D793B4BCE3CAA1DED56356D20B2EBB55A7066F41C25B7C3D56614E06BF84AC455417E2D82765FB84072532408E8BE6D5E2C9F650FB9C9F99650CC1FA062A4A4F2CFE4E6AE69CDD2E8B23ED14AFE66955C23FA048F3A976E3CE8169E505B6A89CC53D4FAC20C2A11BFF84CC65281D94881A982765FB8407AEEA43360B9368B30E7F48286613FD1E3B0207FB71F0308D50412114463E77AB83027C0D40CADAAB8BBF612FC5B6967FA1C407329D47EC61FB0DC3DA1086832F84CC681A68193534F82765FB8407B3CDDE058D5B45D8DB2243660CFEA02E074EC213114C251D7C0C32D0403BB7AB47713D2492FF6C881CFC2AAC3F52CB269768C8968F3B6B18BAC9722D05331F6F84CC66A81A80E81F982765FB84087AB581BB97C212A2DA7EF0D6E105E41B55E4E42CBB6A1AF9A761A01CA8C65069AB4B5827E322CF2C5F59E7F592BE2A817C45AB641F5A9DD368963C73F9EE688F84CC65281D94881A982765FB8408C660DBC6D3DB0186AD10F05FD4F2F0643778EC514E8452A7550C630DA21171A29B1BB67C2E8E101EA1DB39743F3E78C4D2676A13D15515121515FC38B048F37F84CC66381E75881AF82765FB84094FE3D52A2894CEDC6B15424156EB8738A8441DD74BA9CED6664ED30A332A95B574D89262EA367FA900AE9706FB81A408287BDDEF3A9DD9FF44E3A41BC090FDCF84CC64D81B781903782765FB840951FAFCB6F521F0AA23BC58AF19CC40D6795124D89DC8E0CAF23369B67726A1BF6A7B4EF59CD983059B6A67C15F409903C96577CEDDACD89C7423A103C134E08F84DC781D5818181E60A82765FB840952114F110E8AC00DFEA5F050D955E764C7CBA8FB207C05A7AA5AE849168640A2B4E314391FC3A76795B3827055462639CFF4AE2D64AB80E95274428313E366AF84CC6584581C681C682765FB84096F347B096ED1630F474B97623E45E8D471B1D43C22F599607C8B2E3ED0D7B7905D8554AD399DBD739C76126404424D8DB0DC7D2B047C1A328AE27D40906C583F84CC681836881FC0482765FB8409A22C8FB1BD8BBD02F0E74ED9D3D55B0F5B09672BC43A2D47B1ED04238C1C32B6A657426525B15518236E9789B546A4A072A605E1373FE5B996BAEDC30359428F84BC5520C81E35482765FB8409B1A3A8D771B3D949CA394A88EB5DC29A953B02C81F017361FFC0AFE09ABCE3069171A87D474523687FCC9A9D32CC02CFAB4132256FEAABFE05F7AC747194E88F84BC54281D7781C82765FB8409FA7E55B2D98F1D744C76232E4FDA242FE9FD3D5743D16D3CAD2E548A07CB5AF06FE60EBAEB8C6095028179234DCDDD3CDCF1FCFE6EDAA2A53307FD103DA4AF0F84AC455417E2D82765FB840A01F834E9D1A613C3C747E561CAC19CB12D879C1A57420A49C23652B8F51288C8B111AA3888998B05E327F47A235C6A4A377F888E3005A2D4B03ECB7268608D3F84CC6443081AD81A3827A51B840A5FD77C0D432FBFA3317084914C2E8A8821E4BA1DCBA44961FF7480E6DB608789CAB6291416360EA8CDC26B0D2F0877C50E89A70C1BCF5D6DD8B182E0A9E37D3F84DC7818881A081983182765FB840AE31BD0254EE7D10B80FC90E74BA06BA761187DF3138A9799DE5828D0163524C44BAC7D2A9B5C41BE5BE8289A172361F0BA90410C94F579BF7EBD28F18AAA1CDF84CC681D95B81FC3D82765FB840B1D3B2BB241F3297CC1003E5907DD187B9FF3147F816B068D257222629F5AB9EF2AEAF7965F366AF72A299131D23F7A1ECD4A098D7D37D6F52F3A8C0037C52E0F84AC455417E2D82765FB840BA3D216772CDC74558D2545624A2D62DCBCFD272305730C74643C7A7E819AFA6CDD82223E2B5501EB6D4EAE5DBF21E558C768ACAEC2C1CA10E74C4C87A574B53F84AC455417E2D82765FB840BDB49C01872D91BD1EA990BD2EDF16C48171A6067F9A6F7F48BFB194630B5AE9031B5DC263F59C66ADA444CB4E6F9DF62B3017CE612CAB7B53DA08D356F78D30F84CC66381E75881AF82765FB840C12BA91F95044D78EED1D3A9535EBD6471524418135EEB46AD5D5C6ECC2F5168B4AB3A062BB0742AEA65FFEA767FAB8DCC21783CB29BF32E2CD6222209FA71FDF84CC6443081AD81A3827A51B840C2E269E64AA8C9BE2D41812A48AFA2346BD41A1AB2E4646241AE3B8D0CCD41F2D682B15A025F759C0D955A6071D4E8EA7D4DE397D6E052230920113B6EB74C09F84AC44A4F177782765FB840C303B83F6A161F996736344480AE9D88FDC1D9C675BFACA888F70F24897265628209DA53741E03C0F65921F68F602DC9F334A3C45BCB92AF8544A6FB119BD887F84BC50C81FA611A82765FB840C76E7C157B7735511153D1F95081A144E088A989171F3D432CC5D8293ECE9CFAA483C032155D7B53656A6E33A3D75CD0624E09A2F949C156093DBAA83F1111F2F84BC5520C81E35482765FB840C7D5A3691A59599DE333489CBF8A47A7433E92C72706E13D94ED211296D35C97D8357D7E07B3858564D7268ED7AA097F37589C27770F90DD0B07635BE3F53364F84CC64E09819281B282765FB840C88197A82B0ACF0A872494D1DFAC9DE846DAA7DE08B240647A96BA72FBE08FD52B55C6C94514A47EC51BA49A975489EBC9383B48F5E240939068CE5836FF24F1F84BC581B4202B0882765FB840C9E039D8A8B9E435BEF2F45FC7CB7E788716E8C7AFC1BACC64E1246D2AB506D36073792AE696E41AD6BA0C8ABD2EC0D545B0757F94A9F3538280E56DB5F5D8ECF84BC54E6881A35182765FB840CA27683702A8E9BF3201656FF84A60D5B1DD814273993CF1A025B054454E40D53092F48518EE05BEAD4F18021F4F540C0B7C7D26EBA50EA4890B9E5E49A76C5FF84CC681BF81EA393782765FB840CB78D224C1F5F1319EE9FD058050D24F40234570EAA5941046C7F967D8ADD06484776EB60C3BB11ED9E3562D259B9941585FDAD2D5F236564B8253A565483F89F84BC55C4B81D24C82765FB840CD9699760740E99DB8ED79311B80AFDACD6AA937AB1816B42BD3F465814152F3D9973DF578BE4D8C77FBB19416BDE414140AF3289356512F1BFEB54DD2679A94F84AC436481F3782765FB840CE73660A06626C1B3FDA7B18EF7BA3CE17B6BF604F9541D3C6C654B7AE88B239407F659C78F419025D785727ED017B6ADD21952D7E12007373E321DBC31824BAF84AC455417E2D82765FB840CE73F1F1F1F16C1B3FDA7B18EF7BA3CE17B6F1F1F1F141D3C6C654B7AE88B239407FF1F1F1F119025D785727ED017B6ADD21F1F1F1F1000001E321DBC31824BAF84CC66B81AA3981F782765FB840E02B18FBA6B887FB9258469C3AF8E445CC9AE2B5386CAC5F60C4170F822086224E3876555C745A7EC8AC181C7F9701776D94A779604EA12651DE5F4A748D29E1F84CC64081E70A81D082765FB840E31115A76FA7FB2EFD3CFAF46AD00B05FC3498E1BAF1785DFFE6CA69913D256531D180564235FD3D3C10409CD11FC259CF7CFDA9B6BB253340412D82878F3BD3F84BC5415E31819782765FB840E5E8D8C2D762D21CA1E9BCEE8ADC53600F2D894097542666D6B5F41B23584B07F60901AB409DDF91E0CD2562DAFFF2CB0F221EB9F1156F781A5D9931A02A2E07F84BC5567C5281FE82765FB840F6155F1A60143B7D9D5D1A440D7D52FE6809F69E0C6F1E0024457E0D71DD88ADE3B13AAA940C89AC0610952B48BD832C42E343A13E61FFDB06010CFFC345E053F84CC66381E75881AF82765FB840FA568561B7D5288DF7A506C9BC1C9512AB396E68C46F0E62C21DC1AA584B844A8A7E944F6971303665FD37B138D9A5F637E672EDB98969664C4E7FD1C4126DEF";

            byte[] payload = Hex.decode(peersPacketRaw);
            RLPList rlpList = new RLPList();
            RLP.parseObjects(payload, rlpList);

            PeersMessage peersMessage = new PeersMessage(rlpList);
            peersMessage.parseRLP();
        }
        long time2 = System.currentTimeMillis();

        System.out.println("20,000 PEERS packets parsing: " + (time2 - time1) + "(msec)");
    }

    /* TRANSACTIONS */
    
    @Test  /* Transactions message 1 */
    public void test_8(){

        String transactionsPacketRaw = "F86E12F86B04881BC16D674EC8000094CD2A3D9F938E13CD947EC05ABC7FE734DF8DD8268609184E72A00064801BA05E3868194605F1647593B842725818CCFA6A38651A728715133A8E97CDCFAC54A00FF91628D04B215EBCCFD5F4FC34CC1B45DF32F6B4609FBB0DE42E8522264467";

        byte[] payload = Hex.decode(transactionsPacketRaw);
        RLPList rlpList = new RLPList();
        RLP.parseObjects(payload, rlpList);

        TransactionsMessage transactionsMessage = new TransactionsMessage(rlpList);
        System.out.println(transactionsMessage);

        assertEquals(1, transactionsMessage.getTransactions().size());

        Transaction tx =
                transactionsMessage.getTransactions().get(0);

        assertEquals("558A3797E0DD3FBFAF761F1ADD6749C7D5DB313FDAC5CBA59F40E28AF7BBACD1",
                Utils.toHexString( tx.getHash() ).toUpperCase());

        assertEquals("04",
                Utils.toHexString( tx.getNonce() ).toUpperCase());

        assertEquals("1BC16D674EC80000",
                Utils.toHexString( tx.getValue() ).toUpperCase());

        assertEquals("CD2A3D9F938E13CD947EC05ABC7FE734DF8DD826",
                Utils.toHexString( tx.getReceiveAddress() ).toUpperCase());

        assertEquals("09184E72A000",
                Utils.toHexString( tx.getGasPrice() ).toUpperCase());

        assertEquals("64",
                Utils.toHexString( tx.getGas() ).toUpperCase());

        assertEquals("NULL",
                Utils.toHexString( tx.getData() ).toUpperCase());

        assertEquals("NULL",
                Utils.toHexString( tx.getInit() ).toUpperCase());

        assertEquals("1B",
                Utils.toHexString( new byte[] {tx.getSignatureV()} ).toUpperCase());

        assertEquals("5E3868194605F1647593B842725818CCFA6A38651A728715133A8E97CDCFAC54",
                Utils.toHexString( tx.getSignatureR() ).toUpperCase());

        assertEquals("0FF91628D04B215EBCCFD5F4FC34CC1B45DF32F6B4609FBB0DE42E8522264467",
                Utils.toHexString( tx.getSignatureS() ).toUpperCase());
    }

    @Test  /* Transactions message 2 */
    public void test_9(){

        String transactionsPacketRaw = "F9025012F89D80809400000000000000000000000000000000000000008609184E72A000822710B3606956330C0D630000003359366000530A0D630000003359602060005301356000533557604060005301600054630000000C5884336069571CA07F6EB94576346488C6253197BDE6A7E59DDC36F2773672C849402AA9C402C3C4A06D254E662BF7450DD8D835160CBB053463FED0B53F2CDD7F3EA8731919C8E8CCF9010501809400000000000000000000000000000000000000008609184E72A000822710B85336630000002E59606956330C0D63000000155933FF33560D63000000275960003356576000335700630000005358600035560D630000003A590033560D63000000485960003356573360003557600035335700B84A7F4E616D65526567000000000000000000000000000000000000000000000000003057307F4E616D655265670000000000000000000000000000000000000000000000000057336069571BA04AF15A0EC494AEAC5B243C8A2690833FAA74C0F73DB1F439D521C49C381513E9A05802E64939BE5A1F9D4D614038FBD5479538C48795614EF9C551477ECBDB49D2F8A6028094CCDEAC59D35627B7DE09332E819D5159E7BB72508609184E72A000822710B84000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002D0ACEEE7E5AB874E22CCF8D1A649F59106D74E81BA0D05887574456C6DE8F7A0D172342C2CBDD4CF7AFE15D9DBB8B75B748BA6791C9A01E87172A861F6C37B5A9E3A5D0D7393152A7FBE41530E5BB8AC8F35433E5931B";

        byte[] payload = Hex.decode(transactionsPacketRaw);
        RLPList rlpList = new RLPList();
        RLP.parseObjects(payload, rlpList);

        TransactionsMessage transactionsMessage = new TransactionsMessage(rlpList);
        System.out.println(transactionsMessage);

        assertEquals(3, transactionsMessage.getTransactions().size());

        Transaction tx =
                transactionsMessage.getTransactions().get(0);

        assertEquals("4B7D9670A92BF120D5B43400543B69304A14D767CF836A7F6ABFF4EDDE092895",
                Utils.toHexString( tx.getHash() ).toUpperCase());

        assertEquals("NULL",
                Utils.toHexString( tx.getNonce() ).toUpperCase());

        assertEquals("NULL",
                Utils.toHexString( tx.getValue() ).toUpperCase());

        assertEquals("0000000000000000000000000000000000000000",
                Utils.toHexString( tx.getReceiveAddress() ).toUpperCase());

        assertEquals("09184E72A000",
                Utils.toHexString( tx.getGasPrice() ).toUpperCase());

        assertEquals("2710",
                Utils.toHexString( tx.getGas() ).toUpperCase());

        assertEquals("606956330C0D630000003359366000530A0D630000003359602060005301356000533557604060005301600054630000000C58",
                Utils.toHexString( tx.getData() ).toUpperCase());

        assertEquals("33606957",
                Utils.toHexString( tx.getInit() ).toUpperCase());

        assertEquals("1C",
                Utils.toHexString( new byte[] {tx.getSignatureV()} ).toUpperCase());

        assertEquals("7F6EB94576346488C6253197BDE6A7E59DDC36F2773672C849402AA9C402C3C4",
                Utils.toHexString( tx.getSignatureR() ).toUpperCase());

        assertEquals("6D254E662BF7450DD8D835160CBB053463FED0B53F2CDD7F3EA8731919C8E8CC",
                Utils.toHexString( tx.getSignatureS() ).toUpperCase());

        tx = transactionsMessage.getTransactions().get(2);

        assertEquals("B0251A1BB20B44459DB5B5444AB53EDD9E12C46D0BA07FA401A797BEB967D53C",
                Utils.toHexString( tx.getHash() ).toUpperCase());

        assertEquals("02",
                Utils.toHexString( tx.getNonce() ).toUpperCase());

        assertEquals("NULL",
                Utils.toHexString( tx.getValue() ).toUpperCase());

        assertEquals("CCDEAC59D35627B7DE09332E819D5159E7BB7250",
                Utils.toHexString( tx.getReceiveAddress() ).toUpperCase());

        assertEquals("09184E72A000",
                Utils.toHexString( tx.getGasPrice() ).toUpperCase());

        assertEquals("2710",
                Utils.toHexString( tx.getGas() ).toUpperCase());

        assertEquals("00000000000000000000000000000000000000000000000000000000000000000000000000000000000000002D0ACEEE7E5AB874E22CCF8D1A649F59106D74E8",
                Utils.toHexString( tx.getData() ).toUpperCase());

        assertEquals("NULL",
                Utils.toHexString( tx.getInit() ).toUpperCase());

        assertEquals("1B",
                Utils.toHexString( new byte[] {tx.getSignatureV()} ).toUpperCase());

        assertEquals("D05887574456C6DE8F7A0D172342C2CBDD4CF7AFE15D9DBB8B75B748BA6791C9",
                Utils.toHexString( tx.getSignatureR() ).toUpperCase());

        assertEquals("1E87172A861F6C37B5A9E3A5D0D7393152A7FBE41530E5BB8AC8F35433E5931B",
                Utils.toHexString(tx.getSignatureS()).toUpperCase());
    }

    /* BLOCKS */

    @Test /* BlocksMessage parsing 1*/
    public void test_10(){

//        BlockData [ hash=36a24b56c6104e5a5c0e70b0553f1a4d6109d065d718d7443a6a475ec8c83905  parentHash=372d8e5c6e32335fb86fa7a6ae1b35165745346e1c786eacd42df85f8da12b3d, unclesHash=1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347, coinbase=1a4d98707ba8dd3d36d16e8c165c272645695cea, stateHash=5e2d2cc0b42b38b5b18c9d65734f9877c035dd390b9c12c48624f2243668a268, txListHash=1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347, difficulty=02471a26, timestamp=1398260220, extraData=null, nonce=0000000000000000000000000000000000000000000000006f4cd02da011a235]
        String blocksRaw = "F8CC13F8C9F8C5A0372D8E5C6E32335FB86FA7A6AE1B35165745346E1C786EACD42DF85F8DA12B3DA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347941A4D98707BA8DD3D36D16E8C165C272645695CEAA05E2D2CC0B42B38B5B18C9D65734F9877C035DD390B9C12C48624F2243668A268A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D493478402471A26845357C1FC80A00000000000000000000000000000000000000000000000006F4CD02DA011A235C0C0";

        byte[] payload = Hex.decode(blocksRaw);
        RLPList rlpList = new RLPList();
        RLP.parseObjects(payload, rlpList);

        BlocksMessage blocksMessage = new BlocksMessage(rlpList);
        List<Block> list = blocksMessage.getBlockDataList();
        System.out.println(blocksMessage);

        assertEquals(1, list.size());

        Block block = list.get(0);

        assertEquals("36A24B56C6104E5A5C0E70B0553F1A4D6109D065D718D7443A6A475EC8C83905",
                Utils.toHexString(block.getHash()).toUpperCase());

        assertEquals("372D8E5C6E32335FB86FA7A6AE1B35165745346E1C786EACD42DF85F8DA12B3D",
                Utils.toHexString(block.getParentHash()).toUpperCase());

        assertEquals("1DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347",
                Utils.toHexString(block.getUnclesHash()).toUpperCase());

        assertEquals("1A4D98707BA8DD3D36D16E8C165C272645695CEA",
                Utils.toHexString(block.getCoinbase()).toUpperCase());

        assertEquals("5E2D2CC0B42B38B5B18C9D65734F9877C035DD390B9C12C48624F2243668A268",
                Utils.toHexString(block.getStateHash()).toUpperCase());

        assertEquals("1DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347",
                Utils.toHexString(block.getTxListHash()).toUpperCase());

        assertEquals("02471A26", Utils.toHexString(block.getDifficulty()).toUpperCase());
        assertEquals(1398260220, block.getTimestamp());

        assertNull(block.getExtraData());

        assertEquals("0000000000000000000000000000000000000000000000006F4CD02DA011A235",
                Utils.toHexString(block.getNonce()).toUpperCase());
    }

    @Test /* BlocksMessage really big message parsing */
    public void test11(){

        String blocksRaw = "F91C1C13F90150F8C4A07DF3D35D4DF0A56FCF1D6344D5315CB56B9BF83BB96AD17C7B96A9CD14133C5DA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347943854AAF203BA5F8D49B1EC221329C7AEBCF050D3A064AFB6284FA35F26D7B2C5A26AFAA5483072FBCB575221B34CE002A991B7A223A04A8ABE6D802797DC80B497584F898C2D4FD561CC185828CFA1B92F6F38EE348E833FBFE484533F201C80A000000000000000000000000000000000000000000000000000CFCCB5CFD4667CF887F8850380942D0ACEEE7E5AB874E22CCF8D1A649F59106D74E88609184E72A000822710A047617600000000000000000000000000000000000000000000000000000000001CA08691AB40E258DE3C4F55C868C0C34E780E747158A1D96CA50186DFD3305ABD78A042269C981D048A7B791AAFC8F4E644232740C1A1CCEB5B6D05568827A64C0664C0F8C8F8C4A0637C8A6CDB907FAC6F752334AB79065BCC4E46CD4F4358DBC2A653544A20EB31A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347943854AAF203BA5F8D49B1EC221329C7AEBCF050D3A022A36C1A1E807E6AFC22E6BB53A31111F56E7EE7DBB2EE571CEFB152B514DB4DA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347833FCFD784533F1CF980A0000000000000000000000000000000000000000000000000E153D743FA040B18C0C0F8C8F8C4A07B2536237CBF114A043B0F9B27C76F84AC160EA5B87B53E42C7E76148964D450A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347943854AAF203BA5F8D49B1EC221329C7AEBCF050D3A07A3BE0EE10ECE4B03097BF74AABAC628AA0FAE617377D30AB1B97376EE31F41AA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347833FBFE884533F1CE880A0000000000000000000000000000000000000000000000000F3DEEA84969B6E95C0C0F8C8F8C4A0D2AE3F5DD931926DE428D99611980E7CDD7C1B838273E43FCAD1B94DA987CFB8A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347943854AAF203BA5F8D49B1EC221329C7AEBCF050D3A00B5B11FCF4EE12C6812F9D01CF0DFF07C72CD7E02E48B35682F67C595407BE14A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347833FAFFD84533F1CE280A00000000000000000000000000000000000000000000000005FCBC97B2EB8FFB3C0C0F8C8F8C4A094D615D3CB4B306D20985028C78F0C8413D509A75E8BB84EDA95F734DEBAD2A0A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347943854AAF203BA5F8D49B1EC221329C7AEBCF050D3A04B8FD1B98CF5758BD303FF86393EB6D944C1058124BDDCE5D4E04B5395254D5EA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347833FBFEC84533F1C7680A000000000000000000000000000000000000000000000000079FE3710116B32AAC0C0F8C8F8C4A09424A07A0E4C05BB872906C40844A75B76F6517467B79C12FA9CC6D79AE09934A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347943854AAF203BA5F8D49B1EC221329C7AEBCF050D3A02DBE9FF9CBBC4C5A6FF26971F75B405891141F4E9BCE3C2DC4200A305138E584A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347833FCFDF84533F1C3B80A0000000000000000000000000000000000000000000000000E0A6F8CF1D56031BC0C0F8C8F8C4A009AABEA60CF7EAA9DF4AFDF4E1B5F3E684DAB34FC9A9180A050085A4131CEEDFA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347943854AAF203BA5F8D49B1EC221329C7AEBCF050D3A0436DA067F9683029E717EDF92DA46C3443E8C342974F47A563302A0678EFE702A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347833FDFD684533F1BFC80A00000000000000000000000000000000000000000000000005BC88C041662FFDAC0C0F8C8F8C4A0F8B104093483B7C0182E1BBA2CE3340D14469D3A3EE7646821223A676C680AC1A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347943854AAF203BA5F8D49B1EC221329C7AEBCF050D3A0D482E71CDE61190A33CA5AEB88B6B06276984E5A14253A98DF232E8767167221A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347833FEFD184533F1BCE80A00000000000000000000000000000000000000000000000004AEB31823F6A1950C0C0F8C8F8C4A0DD1F0ABA02C2BB3B5A2B6CB1CC907EA70912BD46DC7A78577F2CAE6CDBCBE5F3A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347943854AAF203BA5F8D49B1EC221329C7AEBCF050D3A058AB6DF33D7CBEB6A735A7E4CCF4F28143E6A1742E45DDA8F8CF48AF43CB66C0A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347833FFFD084533F1B9F80A0000000000000000000000000000000000000000000000000577042B0858B510BC0C0F8C8F8C4A0A287BB7DA30F04344976ABE569BD719F69C1CBEA65533E5311CA5862E6EAA504A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347943854AAF203BA5F8D49B1EC221329C7AEBCF050D3A07E0537009C23CB1152CAF84A52272431F74B6140866B15805622B7BCB607CD42A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934783400FD384533F1B6180A000000000000000000000000000000000000000000000000083D31378A0993E1AC0C0F8C8F8C4A063483CFF8FBD489E6CE273326D8DC1D54A31C67F936CA84BF500E5419D3E9805A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347943854AAF203BA5F8D49B1EC221329C7AEBCF050D3A07737D08564819D51F8F834A6EE4278C23A0C2F29A3F485B21002C1F24F04D8E4A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347833FFFD484533F1B5780A0000000000000000000000000000000000000000000000000BB586FE6DE016E14C0C0F8C8F8C4A0975C8ED0C9197B7C018E02E1C95F315ACF82B25E4A812140F4515E8BC827650CA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347943854AAF203BA5F8D49B1EC221329C7AEBCF050D3A0AD51229ABEAD59E93C80DB5BA160F0939BC49DCEE65D1C081F6EB040FF1F571FA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347833FEFD984533F1B4E80A0000000000000000000000000000000000000000000000000548F02C6CEB26FD4C0C0F8C8F8C4A05844082E41F7C1F34485C7902AFA0AA0979A6A849100FC553CD946F4A663929CA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347943854AAF203BA5F8D49B1EC221329C7AEBCF050D3A01BC726443437C4C062BE18D052278E4EF735B8FE84387C8A4FC85FB70D5078E0A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347833FFFD884533F1B1080A0000000000000000000000000000000000000000000000000CC1E528F54F22BDAC0C0F8C8F8C4A0BA06BA81C93FAAF98EA2D83CBDC0788958D938B29A9EB2A92FFBD4A628B3D52EA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347943854AAF203BA5F8D49B1EC221329C7AEBCF050D3A05053BFE1C0F1F0DD341C6DF35E5A659989BE041E8521027CC90F7605EB15FBB9A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347833FEFDD84533F1B0380A0000000000000000000000000000000000000000000000000BCF9DF2FEC615ECAC0C0F8C8F8C4A083732D997DB15109E90464C24B7C959A78881D827C55A0D668A66A2736BE5D87A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347943854AAF203BA5F8D49B1EC221329C7AEBCF050D3A054F4012CBA33A2B80B0DCA9DD52F56B2C588133BD71700863F8CB95127176634A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347833FFFDC84533F1A4680A00000000000000000000000000000000000000000000000006920A1DC9D915D0EC0C0F8C8F8C4A052E2FBA761C2D0643170EF041C017391E781190FE715AE87CDAE8EEE1D45D95BA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347943854AAF203BA5F8D49B1EC221329C7AEBCF050D3A0EE2C82F77D7AFD1F8DBE4F791DF8477496C23E5504B9D66814172077F65F81F2A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347833FEFE184533F1A3880A0000000000000000000000000000000000000000000000000AE86DA9012398FC4C0C0F8C8F8C4A055703BA09544F386966B6D63BFC31033B761A4D1A6BB86B0CF49B4BB0526744EA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347943854AAF203BA5F8D49B1EC221329C7AEBCF050D3A01684C03A675B53786F0077D1651C3D169A009B13A6EE2B5047BE6DBBE6D957FFA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347833FDFEA84533F1A2F80A00000000000000000000000000000000000000000000000003247320D0EB639DFC0C0F8C8F8C4A05109A79B33D81F4EE4814B550FB0002F03368D67570F6D4E6105FCE2874D8B72A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347943854AAF203BA5F8D49B1EC221329C7AEBCF050D3A0AE72E8C60A3DCFD53DEECDB2790D18F0CC710F77CF2C1ED76E7DA829BDE619DCA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347833FCFF784533F1A1D80A000000000000000000000000000000000000000000000000040E0BC9BC9BCF295C0C0F8C8F8C4A03961E4BBBA5C95FAD3DB0CFFA3A16B9106F9EA3E8957993EAB576B683C22F416A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347943854AAF203BA5F8D49B1EC221329C7AEBCF050D3A0E9C6CF457BBE64D6BDA67852A276CDBADB4F384A36D496E81801A496CFD9B7B5A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347833FDFEE84533F19DF80A0000000000000000000000000000000000000000000000000DBB3FD6C816776D8C0C0F8C8F8C4A06B8265A357CB3AD744E19F04EB15377F660C10C900CC352D24F9B09073A363D6A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347943854AAF203BA5F8D49B1EC221329C7AEBCF050D3A07BA07E1BC6A20FFA44AE6080D30982B9FAA148FAF6B1EC15E32D89AC853AC291A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347833FEFE984533F198D80A00000000000000000000000000000000000000000000000005171325B6A2F17F1C0C0F8C8F8C4A0DCDC0347BB87CE72D49AC2E4E11F89069509B129A2536BF3D57C6BCA30894032A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347943854AAF203BA5F8D49B1EC221329C7AEBCF050D3A0CA24447AA0CEDB4B561C7810461EEF19B16A827C27352E5E01F914E9D7C78247A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347833FFFE884533F194680A0000000000000000000000000000000000000000000000000DA4714CFED9D8BBCC0C0F8C8F8C4A047F2DD6C15EA4082B3E11E5CF6B925B27E51D9DE68051A093E52EF465CFFBB8CA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347943854AAF203BA5F8D49B1EC221329C7AEBCF050D3A05A7206EDDDF50FCFEEAA97348A7112FC6EDD0B5EACB44CF43D6A6C6B6609B459A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347833FEFED84533F193E80A0000000000000000000000000000000000000000000000000FFAFBA4BF8DC944EC0C0F8C8F8C4A04D5AD6D860772145872F6660ECEFCB0B0B2056E0AA3509A48BF4C175459E5121A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347943854AAF203BA5F8D49B1EC221329C7AEBCF050D3A00F4659D09BB2CED56E7FD9C4D3D90DACA8B4F471307B7C4385FD34A41016B0B2A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347833FDFF684533F192580A000000000000000000000000000000000000000000000000090620E5E59A39FE5C0C0F8C8F8C4A0C1725C58D1BF023AF468E0088DB3CF642AE097CF2C58C2ECE2FC746980ACC7E6A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347943854AAF203BA5F8D49B1EC221329C7AEBCF050D3A0BE19A182EA1584050DEB0A79ABDC11BE896CE8D00A282BCFAF9FFCD65FD64D6AA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347833FEFF184533F189080A000000000000000000000000000000000000000000000000076F17F4199BCCD12C0C0F8C8F8C4A0BD521A20A18CA6CA7115065065A1AA20067EE580FB11E2963D1E3A681E8302AFA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347943854AAF203BA5F8D49B1EC221329C7AEBCF050D3A011BE45633350E39475A1A07712BA72DE4602D9EEBF639CCD5422A389095CCAF1A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347833FDFFA84533F187B80A00000000000000000000000000000000000000000000000000C71B81C4A4CB82CC0C0F8C8F8C4A07C6D2D56E9C87F1553E4D06705AF61A7C19A6046D2C39F8ED1417988783D3B1DA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347943854AAF203BA5F8D49B1EC221329C7AEBCF050D3A012F5F0668063509E33A45A64EB6A072B2D84AA19F430F49F159BE5008A786B2EA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347833FD00684533F186080A0000000000000000000000000000000000000000000000000B3F962892CFEC9E6C0C0F8C8F8C4A07154F0F8ECC7F791D22EEC06EC86D87A44B2704F015B3D2CFF3571A3D01AE0F6A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347943854AAF203BA5F8D49B1EC221329C7AEBCF050D3A079536ABF8E163CF8AA97F0D52866D04363902D591FD7C36AA35FC983D45FEFD6A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347833FDFFD84533F182F80A0000000000000000000000000000000000000000000000000736716E42499890FC0C0F8C8F8C4A0BF2FB1EE988AC4E17EAE221A24176649774333FAB25B6FC96C6081527FB6F121A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347943854AAF203BA5F8D49B1EC221329C7AEBCF050D3A041578DAAE7BCCCD4976340AEB19E4132D2FE4193A0D92F87744C82BFE113502FA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347833FD00984533F182B80A00000000000000000000000000000000000000000000000001C62FA76645942C6C0C0F8C8F8C4A07F84873E2679D40458B9DDA9900478A78871044E08F6B47DAD659B9B60FF8D48A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347943854AAF203BA5F8D49B1EC221329C7AEBCF050D3A0597D3F4160770C0492333F90BAD739DC05117D0E478A91F09573742E432904E8A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347833FE00184533F17F680A0000000000000000000000000000000000000000000000000E24D8B1140FB34D5C0C0F8C8F8C4A0FD77BD13A8CDE1766537FEBE751A27A2A31310A04638A1AFCD5E8AD3C5485453A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347943854AAF203BA5F8D49B1EC221329C7AEBCF050D3A0473B2B248D91010BA9AEC2696FFC93C11C415ED132832BE0FD0578F184862E13A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347833FEFFC84533F17CA80A0000000000000000000000000000000000000000000000000FB5B65BAC3F0D947C0C0F8C8F8C4A0518916DFB79C390BD7BFF75712174512C2F96BEC42A3F573355507AD1588CE0CA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347943854AAF203BA5F8D49B1EC221329C7AEBCF050D3A08599D2EC9E95EC62F41A4975B655D8445D6767035F94EB235ED5EBEA976FB9EAA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347833FE00484533F17B880A0000000000000000000000000000000000000000000000000BC27F4B8A201476BC0C0F90319F8C4A0AB6B9A5613970FAA771B12D449B2E9BB925AB7A369F0A4B86B286E9D540099CFA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347943854AAF203BA5F8D49B1EC221329C7AEBCF050D3A0990DC3B5ACBEE04124361D958FE51ACB582593613FC290683940A0769549D3EDA09BFE4817D274EA3EB8672E9FE848C3885B53BBBD1D7C26E6039F90FB96B942B0833FF00084533F16B780A000000000000000000000000000000000000000000000000077377ADFF6C227DBF9024FF89D80809400000000000000000000000000000000000000008609184E72A000822710B3606956330C0D630000003359366000530A0D630000003359602060005301356000533557604060005301600054630000000C5884336069571CA07F6EB94576346488C6253197BDE6A7E59DDC36F2773672C849402AA9C402C3C4A06D254E662BF7450DD8D835160CBB053463FED0B53F2CDD7F3EA8731919C8E8CCF9010501809400000000000000000000000000000000000000008609184E72A000822710B85336630000002E59606956330C0D63000000155933FF33560D63000000275960003356576000335700630000005358600035560D630000003A590033560D63000000485960003356573360003557600035335700B84A7F4E616D65526567000000000000000000000000000000000000000000000000003057307F4E616D655265670000000000000000000000000000000000000000000000000057336069571BA04AF15A0EC494AEAC5B243C8A2690833FAA74C0F73DB1F439D521C49C381513E9A05802E64939BE5A1F9D4D614038FBD5479538C48795614EF9C551477ECBDB49D2F8A6028094CCDEAC59D35627B7DE09332E819D5159E7BB72508609184E72A000822710B84000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002D0ACEEE7E5AB874E22CCF8D1A649F59106D74E81BA0D05887574456C6DE8F7A0D172342C2CBDD4CF7AFE15D9DBB8B75B748BA6791C9A01E87172A861F6C37B5A9E3A5D0D7393152A7FBE41530E5BB8AC8F35433E5931BC0";

        byte[] payload = Hex.decode(blocksRaw);
        RLPList rlpList = new RLPList();
        RLP.parseObjects(payload, rlpList);

        BlocksMessage blocksMessage = new BlocksMessage(rlpList);
        List<Block> list = blocksMessage.getBlockDataList();
        System.out.println(blocksMessage);


        assertEquals(32, list.size());

        Block block = list.get(31);

        assertEquals("518916DFB79C390BD7BFF75712174512C2F96BEC42A3F573355507AD1588CE0C",
                Utils.toHexString(block.getHash()).toUpperCase());

        assertEquals("AB6B9A5613970FAA771B12D449B2E9BB925AB7A369F0A4B86B286E9D540099CF",
                Utils.toHexString(block.getParentHash()).toUpperCase());

        assertEquals("1DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347",
                Utils.toHexString(block.getUnclesHash()).toUpperCase());

        assertEquals("3854AAF203BA5F8D49B1EC221329C7AEBCF050D3",
                Utils.toHexString(block.getCoinbase()).toUpperCase());

        assertEquals("990DC3B5ACBEE04124361D958FE51ACB582593613FC290683940A0769549D3ED",
                Utils.toHexString(block.getStateHash()).toUpperCase());

        assertEquals("9BFE4817D274EA3EB8672E9FE848C3885B53BBBD1D7C26E6039F90FB96B942B0",
                Utils.toHexString(block.getTxListHash()).toUpperCase());

        assertEquals("3FF000", Utils.toHexString(block.getDifficulty()).toUpperCase());
        assertEquals(1396643511, block.getTimestamp());

        assertNull(block.getExtraData());

        assertEquals("00000000000000000000000000000000000000000000000077377ADFF6C227DB",
                Utils.toHexString(block.getNonce()).toUpperCase());

        System.out.println(blocksMessage);
    }

    /* GET_CHAIN */

    @Test /* GET_CHAIN message parsing*/
    public void test_12(){

        String getChainRaw = "F9042414A09F7A910147A6C99AB7EEEAC1ADC7B1B9B0D7D9DD83FD7FC125561016F19B624DA024B519ED5F71207330C1F450B7A4C7445C589B5F9AE73E9BBA09E0A8CB15D845A01EF7B03C7E58E65068D71F68E168C0CC0438808C32FB3E46E402D078B2020E0DA06A0F152620F606E134679D22A86156F9DDEB56FACD62C3106CC66AE030234483A001A3E918F9C2F74BD144505CF70650EF30BE806C533BA5AE3C983F55615EE98EA0E5E441F0877116011CCDECE2501A50B40C40418377037E16D0282B2B5E347138A0C55035BC5BDA25A8C6A2EFF4CCF5386CFFF3E7EE1DC9168B00AABF1074FEB1E2A060AC4D0C12C4CBF552440E659FE4E54C38EF7D05EF98965BA0E0248379CB78DFA0E1620BF60A735DDEA7CB434143E7EF663D043420F017360289FF78046948A77AA0DA8BC25F6571AB0EDE9C3DEF34FFF996575ADFCC1F8009A0388CE0A63AD9FC57A0E153CD998421E4F6BAC6A8329AE90BDA70D5D0F46A7EC02B88BDF5D3CAA8384FA0D3F00977D766A5CAF8F07EF8D15B1DADBBFD57B60BBE6CA54B2F9C2446F614EFA08687EC7AE1A541B13CDA57DCF387DEA3EA35A35AC3D5A9381376EAFBC7BA2CF5A08814AC8660E776A3FCA432D2E9A3533AFFEAEC783ECBB5DAD495B44E04EF1F98A07F2E67F508830BF18E8A432BAB9B957FA2BCDE57BE6C766C13871F833C27B9A5A021EE1E6602530EF711F6C8022799108E1AFB546E7B5FF3E3CBB4DA66C054868DA02940A17DD5C1D1911FFDA7DFAE3E5FAF8E1808CBD11F3248C18B8777B4A5D256A07E5D2F25D9750665ADBFF9C36820AD67CC55850D7D798DAB512343AB0C4E58B3A06674BD13B1051852413031BAA885448E50917D7F1D5EFB7DBA397ED4E5C36D72A06AA7A7D18B07BE0222DA47A8EE6923BAD522DBF5D0650D64CA0F2AD4C606D0CCA07F877735FCC29F804926AACEDBF7AD4896E330DCCE57F257A7D5C81F5CC03188A0FF6B7749526281A5E6A845B8ACC7DC03D2CAAEAFF0CEBF78659FDE1007AD9C05A054D6375CF54B0246FB45787206BA70115DED577354942A9219BC9E761A7E0CBCA0809384946576FB15A8F827B30045D18203A90BE662863D5F205B868DF882472AA05A6EA58D02A2823BA693AC11C21D3C4D66AFFFDB9F1475EA86A461912C2F3187A003AF21F3939C29C231200B1F790F16421A8923254CBF2A90455B9B8F28BE4562A036FDFB3E05936CAA1ABBDCFBBACD9000F86FBCAE2228E77346533CEF17073767A0D3CE8B71E129020F3356A09946F9BC4C18E61D9516E74F6F912461A438F1E006A01D8203A8E23F50D70188ED3099E50645B92959C2216EA7A74719C159B4978BDBA03812A8FC4A5BB6EF0832EBF5058FAF65A46187CEE568C94915AE1850069775F3A0687DDEF8750F606637B3F5F23D286053671081A1AD224B35A624DE7392193951A0E6A8E1D4417292E20F9698A3464CEEABC6476A57521FF79D994DE22C55DADEAD820100";

        byte[] payload = Hex.decode(getChainRaw);
        RLPList rlpList = new RLPList();
        RLP.parseObjects(payload, rlpList);

        GetChainMessage getChainMessage = new GetChainMessage(rlpList);
        getChainMessage.parseRLP();
        System.out.println(getChainMessage);

        assertEquals(32, getChainMessage.getBlockHashList().size());

        assertEquals("E5E441F0877116011CCDECE2501A50B40C40418377037E16D0282B2B5E347138",
                Utils.toHexString( getChainMessage.getBlockHashList().get(5) ).toUpperCase());

        assertEquals("6AA7A7D18B07BE0222DA47A8EE6923BAD522DBF5D0650D64CA0F2AD4C606D0CC",
                Utils.toHexString( getChainMessage.getBlockHashList().get(19) ).toUpperCase());

        assertEquals("03AF21F3939C29C231200B1F790F16421A8923254CBF2A90455B9B8F28BE4562",
                Utils.toHexString( getChainMessage.getBlockHashList().get(25) ).toUpperCase());
    }

    /* NOT_IN_CHAIN */

    @Test /* NotInChainMessage parsing 1 */
    public void test_13(){

        String getChainRaw = "E015A0E5E441F0877116011CCDECE2501A50B40C40418377037E16D0282B2B5E347138";

        byte[] payload = Hex.decode(getChainRaw);
        RLPList rlpList = new RLPList();
        RLP.parseObjects(payload, rlpList);

        NotInChainMessage notInChainMessage = new NotInChainMessage(rlpList);
        System.out.println(notInChainMessage);

        assertEquals("E5E441F0877116011CCDECE2501A50B40C40418377037E16D0282B2B5E347138",
                Utils.toHexString(notInChainMessage.getHash()).toUpperCase());
    }
}

